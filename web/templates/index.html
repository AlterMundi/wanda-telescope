{% extends "base.html" %}

{% block content %}
<div class="ui-shell" data-night-vision="{{ 'true' if night_vision_mode else 'false' }}">
    <header class="ui-shell__header">
        <div class="ui-shell__brand">
            <div class="ui-shell__brand-icon">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2.75a2.25 2.25 0 0 1 2.25 2.25v.69a7.5 7.5 0 0 1 4.31 11.3l.44.44a1.25 1.25 0 0 1-1.77 1.77l-.44-.44A7.5 7.5 0 0 1 12 20.31a7.5 7.5 0 0 1-4.75-1.7l-.44.44a1.25 1.25 0 0 1-1.77-1.77l.44-.44A7.5 7.5 0 0 1 9.75 5.69v-.69A2.25 2.25 0 0 1 12 2.75Zm0 4.5a5.25 5.25 0 1 0 5.25 5.25A5.26 5.26 0 0 0 12 7.25Zm0 2a3.25 3.25 0 1 1-3.25 3.25A3.25 3.25 0 0 1 12 9.25Z"/></svg>
            </div>
            <div>
                <h1 class="ui-shell__title">Wanda Telescope</h1>
                <p class="ui-shell__subtitle">Wide-Angle Nightsky Digital Astrophotographer</p>
            </div>
            <span class="ui-chip ui-chip--success">Connected</span>
        </div>
        <div class="ui-shell__actions">
            <button type="button" class="ui-icon-button" data-action="open-settings" aria-label="Open settings">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19.14 12.94a7.14 7.14 0 0 0 0-1.88l2.06-1.6a.5.5 0 0 0 .12-.64l-2-3.46a.5.5 0 0 0-.6-.22l-2.43 1a7.09 7.09 0 0 0-1.62-.94l-.37-2.6a.5.5 0 0 0-.5-.42h-4a.5.5 0 0 0-.5.42l-.37 2.6a7.09 7.09 0 0 0-1.62.94l-2.43-1a.5.5 0 0 0-.6.22l-2 3.46a.5.5 0 0 0 .12.64l2.06 1.6a7.14 7.14 0 0 0 0 1.88l-2.06 1.6a.5.5 0 0 0-.12.64l2 3.46a.5.5 0 0 0 .6.22l2.43-1a7.09 7.09 0 0 0 1.62.94l.37 2.6a.5.5 0 0 0 .5.42h4a.5.5 0 0 0 .5-.42l.37-2.6a7.09 7.09 0 0 0 1.62-.94l2.43 1a.5.5 0 0 0 .6-.22l2-3.46a.5.5 0 0 0-.12-.64ZM12 15.5A3.5 3.5 0 1 1 15.5 12 3.5 3.5 0 0 1 12 15.5Z"/></svg>
            </button>
        </div>
    </header>

    <div class="ui-shell__body">
        <aside class="ui-panel ui-panel--left">
            <div class="ui-tabs" role="tablist">
                <button class="ui-tab-button active" data-tab-target="camera" role="tab" aria-selected="true">Camera</button>
                <button class="ui-tab-button" data-tab-target="mount" role="tab">Mount</button>
                <button class="ui-tab-button" data-tab-target="session" role="tab">Session</button>
            </div>
            <div class="ui-tab-content" id="tab-camera" role="tabpanel">
                {% include "components/camera-controls.html" %}
            </div>
            <div class="ui-tab-content" id="tab-mount" role="tabpanel" hidden>
                {% include "components/mount-controls.html" %}
            </div>
            <div class="ui-tab-content" id="tab-session" role="tabpanel" hidden>
                {% include "components/session-controls.html" %}
            </div>
        </aside>

        <main class="ui-main">
            <section class="ui-viewport">
                <div class="ui-viewport__meta">
                    <div>
                        <h2 class="ui-viewport__title">Live Feed</h2>
                        <p class="ui-viewport__subtitle">Exposure {{ current_exposure }} â€¢ ISO {{ current_iso_label }}</p>
                    </div>
                    <div class="ui-toggle-group">
                        <button type="button" class="ui-toggle-button" data-toggle="histogram">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3a1 1 0 0 0-1 1v16h2V5h2v15h2V9h2v11h2v-5h2v5h2v-7h2v7h2V7h2v13h2V4a1 1 0 0 0-1-1Z"/></svg>
                            Histogram
                        </button>
                        <button type="button" class="ui-toggle-button" data-toggle="focus-assist">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 7a5 5 0 1 0 5 5 5 5 0 0 0-5-5Zm0-4a9 9 0 1 1-9 9 9 9 0 0 1 9-9Zm0 13.5a4.5 4.5 0 0 0 0-9v9Z"/></svg>
                            Focus Assist
                        </button>
                        <button type="button" class="ui-toggle-button" data-action="toggle-fullscreen">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 4H4v4H2V2h6Zm14 0h-4V2h6v6h-2Zm-4 16h4v-4h2v6h-6Zm-8 0v2H2v-6h2v4Z"/></svg>
                            Fullscreen
                        </button>
                    </div>
                </div>
                <div class="ui-viewport__display" data-show-histogram="false" data-show-focus-assist="false">
                    <img src="{{ url_for('video_feed') }}" alt="Camera Feed" class="ui-viewport__image" loading="lazy">
                    <div class="ui-overlay ui-overlay--histogram" hidden>
                        <canvas id="histogramCanvas" width="280" height="120" aria-hidden="true"></canvas>
                    </div>
                    <div class="ui-overlay ui-overlay--focus" hidden>
                        <div class="ui-focus-grid" aria-hidden="true"></div>
                    </div>
                </div>
            </section>

            <footer class="ui-status-bar">
                <div class="ui-status-bar__section">
                    <span class="ui-status-bar__label">Capture Status</span>
                    <span class="ui-status-bar__value" data-status-text>{{ capture_status }}</span>
                </div>
                <div class="ui-status-bar__section">
                    <span class="ui-status-bar__label">Mount</span>
                    <span class="ui-status-bar__value">{{ 'Tracking' if mount_tracking else 'Idle' }}</span>
                </div>
                <div class="ui-status-bar__section">
                    <span class="ui-status-bar__label">Session</span>
                    <span class="ui-status-bar__value" data-session-status>Idle</span>
                </div>
            </footer>
        </main>

        <aside class="ui-panel ui-panel--right">
            <section class="ui-panel__section">
                <h2 class="ui-panel__title">Capture Queue</h2>
                <p class="ui-panel__meta"><span data-capture-count>0</span> images captured</p>
                <div class="ui-panel__actions">
                    <form id="capture-form" action="{{ url_for('capture_still') }}" method="post" class="ui-action-form" data-ajax="false">
                        <button type="submit" class="ui-button ui-button--primary" data-action="capture-still">Capture Still</button>
                    </form>
                    <form id="start-video-form" action="{{ url_for('start_video') }}" method="post" class="ui-action-form" data-form="start-video" data-ajax="false">
                        <button type="submit" class="ui-button" data-action="start-video">Start Video</button>
                    </form>
                    <form id="stop-video-form" action="{{ url_for('stop_video') }}" method="post" class="ui-action-form" data-form="stop-video" data-ajax="false">
                        <button type="submit" class="ui-button" data-action="stop-video">Stop Video</button>
                    </form>
                </div>
            </section>
            <section class="ui-panel__section">
                <h3 class="ui-panel__subtitle">Recent Captures</h3>
                <div class="ui-thumbnails" data-capture-grid>
                    <!-- thumbnails appended here -->
                </div>
            </section>
        </aside>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/camera-controls.js') }}"></script>
<script src="{{ url_for('static', filename='js/mount-controls.js') }}"></script>
<script src="{{ url_for('static', filename='js/session-controls.js') }}"></script>
<script src="{{ url_for('static', filename='js/wanda-ui.js') }}"></script>
{% endblock %}